<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Multiple Polygons Test</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #1a1a2e; color: white; }
    #chart { border: 1px solid #333; margin: 20px 0; }
    #log { background: #0d0d1a; padding: 10px; white-space: pre-wrap; font-family: monospace; font-size: 12px; max-height: 300px; overflow: auto; }
  </style>
</head>
<body>
  <h1>Multiple Polygons Test</h1>
  <div id="chart"></div>
  <div id="log"></div>

  <script type="module">
    import * as VizAPI from './js/viz-api.js';

    const log = document.getElementById('log');
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;

    console.log = (...args) => {
      originalConsoleLog(...args);
      log.textContent += args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ') + '\n';
    };
    console.error = (...args) => {
      originalConsoleError(...args);
      log.textContent += '[ERROR] ' + args.map(a => typeof a === 'object' ? JSON.stringify(a, null, 2) : a).join(' ') + '\n';
    };

    const config = {
      "purpose": "chart",
      "datasets": [
        {
          "data": [1, 3, 3, 5, 5, 5, 7, 7, 7, 7, 7, 7, 7, 9, 9, 9, 9, 9, 11, 11],
          "polygonColorPreset": "primary",
          "callout": { "template": "남학생" }
        },
        {
          "data": [1, 1, 3, 3, 3, 5, 5, 7, 7, 7, 7, 7, 7, 9, 9, 9, 9, 9, 11, 11, 12, 12],
          "polygonColorPreset": "secondary",
          "callout": { "template": "여학생" }
        }
      ],
      "classRange": {
        "firstEnd": 1,
        "secondEnd": 3,
        "lastStart": 13
      },
      "canvasSize": 700,
      "options": {
        "showHistogram": false,
        "showPolygon": true,
        "dataType": "frequency",
        "axisLabels": {
          "xAxis": "(회)",
          "yAxis": "학생 수(명)"
        }
      }
    };

    console.log('Config:', config);

    try {
      const result = await VizAPI.renderChart(document.getElementById('chart'), config);
      console.log('Result:', result);
      if (result.error) {
        console.error('Render error:', result.error);
      }
    } catch (e) {
      console.error('Exception:', e.message, e.stack);
    }
  </script>
</body>
</html>
