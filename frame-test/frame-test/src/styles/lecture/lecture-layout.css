/* ===== 뷰포트 및 프레임 컨테이너 ===== */
.viewport {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    position: relative;
}

/* 프레임 컨테이너 - 여러 프레임을 관리 */
.frame-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    overflow: hidden;
}

/* 개별 칠판 프레임 */
.frame-container .chalk-frame {
    width: 100vw;
    height: 100vh;
    position: absolute;
    top: 0;
    left: 0;
    transition: transform 0.8s ease-in-out;
    transform-origin: 50% 50%;
    opacity: 1;
    z-index: 1;
    padding: calc(100px * var(--scale-factor));
    box-sizing: border-box;
}

/* 현재 활성 프레임 */
.chalk-frame.active {
    z-index: 10;
}

/* 비활성 프레임 숨김 */
.chalk-frame.hidden {
    opacity: 0;
    pointer-events: none;
}

/* ===== 카메라 무빙 스테이지 (동적 생성) ===== */
/* 기본 cut 스타일들 - JavaScript에서 동적 생성 */

/* ===== 배경 장식 ===== */
.background-decoration {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 0;
    opacity: 1;
    transition: opacity 0.8s ease-out;
}

.background-decoration.hidden {
    opacity: 0;
}


.bg-circle {
    position: absolute;
    opacity: 1;
    overflow: visible;
}

/* SVG 방식 스타일 (모든 스타일을 CSS에서 관리) */
svg.bg-circle circle {
    stroke: #3a3a4a;
    stroke-width: 0.15;
}

svg.bg-circle .rotating-dot {
    r: 0.8;
    fill: #3a3a4a;
}

/* 배경 동그라미 fade-in 애니메이션 */
@keyframes bgCircleFadeIn {
    from {
        opacity: 0;
    }

    to {
        opacity: 1;
    }
}

.bg-circle-fade-in-animation {
    animation: bgCircleFadeIn 1s cubic-bezier(0.5, 0, 0.4, 1) forwards;
}

.bg-circle-1 {
    --circle-size: clamp(462px, 61.59vw, 924px);
    width: var(--circle-size);
    height: var(--circle-size);
    top: -100px;
    left: 100px;
}

.bg-circle-2 {
    --circle-size: clamp(462px, 61.59vw, 924px);
    width: var(--circle-size);
    height: var(--circle-size);
    bottom: -415px;
    right: 110px;
}

/* 배경이 frame 밖에 있으므로 항상 표시됨 (JavaScript로 제어) */
/* SVG는 animateTransform으로 자체 회전 동작 */

/* ===== 메인 컨테이너 ===== */
.main-container {
    position: relative;
    z-index: 1;
    max-width: calc(clamp(900px, 75vw, 1200px) * var(--scale-factor));
    margin: 0 auto;
    padding: calc(clamp(15px, 1.25vw + 7.5px, 20px) * var(--scale-factor));
    transform: scale(var(--scale-factor));
    transform-origin: top center;
}

/* ===== 헤더 ===== */
.header {
    text-align: center;
    margin-bottom: clamp(26px, 3.33vw + 13px, 67px);
    display: flex;
    flex-direction: column;
    align-items: center;
}

.chalk-frame[data-frame-index="0"] .header {
    margin-bottom: clamp(26px, 3.33vw + 13px, 67px);
}

/* 기본 chapter-badge 스타일 */
.chapter-badge {
    font-family: 'SCDream';
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-bottom: clamp(30px, 2.5vw + 10px, 40px);
    position: relative;
    /* 강의명인 경우 (기본값) */
    color: #EBEBEB;
    border: 3px solid #A2FF72;
    padding: clamp(11px, 0.9375vw + 3.75px, 15px) clamp(22px, 1.875vw + 7.5px, 30px);
    border-radius: clamp(43px, 3.59375vw + 14.375px, 57.5px);
    font-size: clamp(22px, 1.875vw + 7.5px, 30px);
}

.chapter-badge::after {
    content: '';
    position: absolute;
    top: clamp(2.1px, 0.09375vw + 1.375px, 2.5px);
    left: calc(90% + clamp(2.4px, 0.28125vw + 0.125px, 3.5px));
    transform: translateX(-50%);
    width: clamp(10px, 0.8125vw + 3.25px, 13px);
    height: clamp(10px, 0.8125vw + 3.25px, 13px);
    background: #A2FF72;
    border-radius: 50%;
    box-shadow: 0 0 clamp(30px, 2.5vw + 10px, 40px) clamp(7px, 0.625vw + 2.5px, 10px) rgba(162, 255, 114, 0.7);
}

/* 숫자(번호)인 경우 */
.chapter-badge.number {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #000000;
    background: #A2FF72;
    border: none;
    padding: 0;
    width: clamp(34px, 2.8125vw + 11.25px, 45px);
    height: clamp(34px, 2.8125vw + 11.25px, 45px);
    border-radius: 50%;
    font-size: clamp(26px, 2.1875vw + 8.75px, 35px);
    font-weight: 700;
    margin-bottom: clamp(22px, 1.875vw + 7.5px, 30px);
}

.chapter-badge.number::after {
    display: none;
}

/* Summary인 경우 */
.chapter-badge.summary {
    color: #EBEBEB;
    border: 2px solid #DB6FE7;
    padding: clamp(7px, 0.625vw + 2.5px, 10px) clamp(11px, 0.9375vw + 3.75px, 15px);
    border-radius: clamp(43px, 3.59375vw + 14.375px, 57.5px);
    font-size: clamp(15px, 1.25vw + 5px, 20px);
    margin-bottom: clamp(22px, 1.875vw + 7.5px, 30px);
}

.chapter-badge.summary::after {
    width: clamp(9px, 0.75vw + 3px, 12px);
    height: clamp(9px, 0.75vw + 3px, 12px);
    background: #DB6FE7;
    box-shadow: 0 0 clamp(30px, 2.5vw + 10px, 40px) clamp(7px, 0.625vw + 2.5px, 10px) rgba(219, 111, 231, 0.7);
}

/* 강의명인 경우 */
.chapter-badge.text {
    color: #EBEBEB;
    background: transparent;
    font-size: clamp(24px, 2vw + 8px, 32px);
    padding: 0;
    border: 3px solid #A2FF72;
    border-radius: clamp(37px, 3.125vw + 12.5px, 50px);
    width: auto;
    height: auto;
    margin-bottom: clamp(33px, 2.75vw + 11px, 44px);
}

/* chapter-badge scale-up 애니메이션 */
.chapter-badge.badge-scale-up {
    opacity: 0;
    transform: scale(0);
    animation: badgeScaleUp 0.5s ease-out 0.5s forwards;
}

/* chapter-badge의 ::after도 scale-up (badge 애니메이션 완료 후, fade in 없음) */
.chapter-badge.badge-scale-up::after {
    opacity: 1;
    transform: translateX(-50%) scale(0);
    animation: badgeAfterScaleUp 0.3s ease-out 0.8s forwards;
}

/* number 타입은 ::after가 없으므로 애니메이션 제거 */
.chapter-badge.number.badge-scale-up::after {
    animation: none;
}

@keyframes badgeScaleUp {
    0% {
        transform: scale(0);
        opacity: 0;
    }

    50% {
        transform: scale(1.1);
    }

    100% {
        transform: scale(1);
        opacity: 1;
    }
}

@keyframes badgeAfterScaleUp {
    0% {
        transform: translateX(-50%) scale(0);
    }

    50% {
        transform: translateX(-50%) scale(1.1);
    }

    100% {
        transform: translateX(-50%) scale(1);
    }
}

.main-title {
    text-align: center;
    font-family: 'SCDream';
    font-weight: 500;
    font-size: clamp(42px, 3.75vw + 15px, 60px);
    font-style: normal;
    line-height: 1.2;
    margin-bottom: clamp(15px, 1.25vw + 5px, 20px);
    white-space: nowrap;
}

.chalk-frame .main-title {
    color: #A2FF72;
}

.chalk-frame[data-frame-index="0"] .main-title {
    font-size: clamp(63px, 5.625vw + 22.5px, 90px);
}

.chalk-frame .main-title .MathJax,
.chalk-frame .main-title .MathJax *,
.chalk-frame .main-title .math,
.chalk-frame .main-title .math * {
    color: #A2FF72;
}


.subtitle {
    color: #EBEBEB;
    font-size: clamp(25px, 2.125vw + 8.5px, 34px);
    font-family: 'SCDream', sans-serif;
    font-weight: 500;
    margin-bottom: clamp(7px, 0.625vw + 2.5px, 10px);
    position: relative;
    padding-top: 0;
    display: inline-block;
    overflow: visible;
}

/* tip-badge가 포함된 subtitle에 tip-wrapper 스타일 적용 */
/* .subtitle:has(.tip-badge) {
    padding-left: clamp(15px, 1.25vw + 5px, 20px);
    padding-right: clamp(15px, 1.25vw + 5px, 20px);
    align-items: center;
} */

.subtitle::before {
    content: '';
    position: absolute;
    top: clamp(7px, 0.625vw + 2.5px, 10px);
    left: clamp(-15px, -1.25vw - 5px, -20px);
    width: calc(100% + clamp(15px, 1.25vw + 5px, 20px));
    height: clamp(2px, 0.1875vw + 0.75px, 3px);
    background: #A2FF72;
}

.subtitle::after {
    content: '';
    position: absolute;
    top: clamp(3.4px, 0.28125vw + 1.125px, 4.5px);
    left: clamp(-22px, -1.875vw - 7.5px, -30px);
    width: clamp(10px, 0.8125vw + 3.25px, 13px);
    height: clamp(10px, 0.8125vw + 3.25px, 13px);
    background: #A2FF72;
    border-radius: 50%;
}

.subtitle {
    position: relative;
}

.subtitle:not(:empty)::after {
    box-shadow: calc(100% + 13px) 0 0 0 #A2FF72;
}

/* 새롭게 추가할 코드 */
/* .tip-wrapper {
    position: relative;
    display: inline-flex;
    align-items: center;
    padding-left: clamp(22px, 1.875vw + 7.5px, 30px);
    padding-right: clamp(22px, 1.875vw + 7.5px, 30px);
} */

/* 가로선 스타일 */
/* .tip-wrapper::before {
    content: '';
    position: absolute;
    height: clamp(1.5px, 0.125vw + 0.5px, 2px);
    width: calc(100% - clamp(15px, 1.25vw + 5px, 20px));
    background: #A2FF72;
    left: clamp(11px, 0.9375vw + 3.75px, 15px);
    top: 50%;
    transform: translateY(-50%);
    z-index: 0;
} */

/* 왼쪽 원 스타일 */
/* .tip-wrapper::after {
    content: '';
    position: absolute;
    height: clamp(7px, 0.625vw + 2.5px, 10px);
    width: clamp(7px, 0.625vw + 2.5px, 10px);
    background: #A2FF72;
    border-radius: 50%;
    left: clamp(4px, 0.3125vw + 1.25px, 5px);
    top: 50%;
    transform: translateY(-50%);
    z-index: 1;
} */

/* tip-badge의 오른쪽 원 */
/* .tip-badge::before {
    content: '';
    position: absolute;
    height: clamp(7px, 0.625vw + 2.5px, 10px);
    width: clamp(7px, 0.625vw + 2.5px, 10px);
    background: #A2FF72;
    border-radius: 50%;
    right: clamp(-675px, -56.25vw - 225px, -900px);
    top: 15%;
    transform: translateY(-50%);
    z-index: 1;
} */

/* 기존 .tip-badge 코드 수정 */
/* .tip-badge {
    background: #A2FF72;
    color: #000000;
    padding: clamp(19px, 1.5625vw + 6.25px, 25px) clamp(6px, 0.5vw + 2px, 8px);
    font-size: clamp(19px, 1.625vw + 6.5px, 26px);
    font-weight: 700;
    font-family: 'scdream', sans-serif;
    text-align: center;
    display: inline-block;
    position: relative;
    line-height: 1.2;
    border-radius: clamp(4px, 0.3125vw + 1.25px, 5px);
    z-index: 1;
} */


/* 기존 .tip-badge::after 코드는 그대로 유지 */
/* .tip-badge::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    border-style: solid;
    border-width: 0 clamp(22px, 1.875vw + 7.5px, 30px) clamp(12px, 1vw + 4px, 16px) clamp(22px, 1.875vw + 7.5px, 30px);
    border-color: transparent transparent #0C0C1A transparent;
    border-top-left-radius: clamp(2px, 0.1875vw + 0.75px, 3px);
    border-top-right-radius: clamp(2px, 0.1875vw + 0.75px, 3px);
} */

/* ===== 콘텐츠 영역 ===== */
.content-area {
    display: flex;
    gap: 20px;
    justify-content: center;
    align-items: flex-start;
    flex-wrap: wrap;
    transform-origin: top center;
}

/* Intro 프레임의 content-area 기본 설정 */
.chalk-frame[data-frame-index="0"] .content-area {
    transition: opacity 0.8s ease-out, visibility 0.8s ease-out;
}

/* Intro 프레임의 content-area들을 겹쳐지게 배치 (타이틀 아래) */
.chalk-frame[data-frame-index="0"] .content-area {
    position: absolute;
    top: auto;
}


/* ===== 씬 배치 레이아웃 ===== */
/* 1x1 구조 - 단일 개념 */
.scene-layout-1x1 {
    display: grid;
    grid-template-columns: 1fr;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

/* 1x2 구조 - 비교/대조 */
.scene-layout-1x2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    align-items: stretch;
    justify-items: center;
}

/* 2x1 구조 - 순서/인과 */
.scene-layout-2x1 {
    display: grid;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

/* 1x3 구조 - 나열 */
.scene-layout-1x3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    row-gap: clamp(45px, 3.75vw + 22.5px, 75px);
    column-gap: clamp(45px, 3.75vw + 22.5px, 75px);
    width: 100%;
    align-items: stretch;
    justify-items: center;
}

.scene-layout-1x3 .scene-title {
    font-size: clamp(51px, 4.21875vw + 16.875px, 67.5px);
}

.scene-layout-1x3 .explanation-text {
    font-size: clamp(36px, 3vw + 15px, 54px);
}

/* 2x2 구조 - 분류 */
.scene-layout-2x2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    align-items: stretch;
    justify-items: center;
}

/* 2x3 구조 - 예시 다수 */
.scene-layout-2x3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    align-items: stretch;
    justify-items: center;
}

/* 추가 예외적 구조 */
/* 1x4 구조 */
.scene-layout-1x4 {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    align-items: stretch;
    justify-items: center;
}

/* 1+2 구조 - 3개 씬 */
.scene-layout-1-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

.scene-layout-1-2>.math-scene:nth-child(1) {
    grid-column: 1 / 3;
}

.scene-layout-1-2>.math-scene:nth-child(2) {
    grid-column: 1 / 2;
    grid-row: 2;
}

.scene-layout-1-2>.math-scene:nth-child(3) {
    grid-column: 2 / 3;
    grid-row: 2;
}

/* 1+2+2 구조 - 위계적 5개 씬 */
.scene-layout-1-2-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

.scene-layout-1-2-2>.math-scene:nth-child(1) {
    grid-column: 1 / 3;
}

.scene-layout-1-2-2>.math-scene:nth-child(2) {
    grid-column: 1 / 2;
    grid-row: 2;
}

.scene-layout-1-2-2>.math-scene:nth-child(3) {
    grid-column: 2 / 3;
    grid-row: 2;
}

/* 2+3 구조 */
.scene-layout-2-3 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

.scene-layout-2-3>.math-scene:nth-child(1) {
    grid-column: 1 / 2;
}

.scene-layout-2-3>.math-scene:nth-child(2) {
    grid-column: 2 / 4;
}

.scene-layout-2-3>.math-scene:nth-child(3) {
    grid-column: 1 / 2;
    grid-row: 2;
}

.scene-layout-2-3>.math-scene:nth-child(4) {
    grid-column: 2 / 3;
    grid-row: 2;
}

.scene-layout-2-3>.math-scene:nth-child(5) {
    grid-column: 3 / 4;
    grid-row: 2;
}

/* 3+2 구조 */
.scene-layout-3-2 {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    grid-template-rows: auto auto;
    row-gap: clamp(30px, 2.5vw + 15px, 50px);
    column-gap: clamp(30px, 2.5vw + 15px, 50px);
    width: 100%;
    justify-items: center;
    align-items: start;
}

.scene-layout-3-2>.math-scene:nth-child(1) {
    grid-column: 1 / 2;
}

.scene-layout-3-2>.math-scene:nth-child(2) {
    grid-column: 2 / 3;
}

.scene-layout-3-2>.math-scene:nth-child(3) {
    grid-column: 3 / 4;
}

.scene-layout-3-2>.math-scene:nth-child(4) {
    grid-column: 1 / 2;
    grid-row: 2;
}

.scene-layout-3-2>.math-scene:nth-child(5) {
    grid-column: 2 / 4;
    grid-row: 2;
}

/* 반응형 디자인 */
@media (max-width: 1200px) {

    .scene-layout-1x3,
    .scene-layout-2x3,
    .scene-layout-1x4 {
        grid-template-columns: 1fr 1fr;
        grid-template-rows: auto;
    }

    .scene-layout-2-3 .scene-row-2,
    .scene-layout-3-2 .scene-row-1 {
        grid-template-columns: 1fr 1fr;
    }
}

@media (max-width: 768px) {

    .scene-layout-1x2,
    .scene-layout-1x3,
    .scene-layout-2x2,
    .scene-layout-2x3,
    .scene-layout-1x4,
    .scene-layout-1-2-2 .scene-row-2,
    .scene-layout-1-2-2 .scene-row-3,
    .scene-layout-2-3 .scene-row-1,
    .scene-layout-2-3 .scene-row-2,
    .scene-layout-3-2 .scene-row-1,
    .scene-layout-3-2 .scene-row-2 {
        grid-template-columns: 1fr;
    }
}
