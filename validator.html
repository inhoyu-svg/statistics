<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Statistics JSON ë™ì‘ ê²€ì¦ê¸°</title>
  <style>
    /* í°íŠ¸ */
    @font-face {
      font-family: 'SCDream';
      src: url('./frame-test/frame-test/public/assets/fonts/SCDream/SCDream3.otf') format('opentype');
      font-weight: 300;
    }
    @font-face {
      font-family: 'SCDream';
      src: url('./frame-test/frame-test/public/assets/fonts/SCDream/SCDream5.otf') format('opentype');
      font-weight: 500;
    }

    /* ë‹¤í¬ í…Œë§ˆ */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #1a1a2e;
      color: #eee;
      font-family: 'SCDream', -apple-system, BlinkMacSystemFont, sans-serif;
      font-weight: 300;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      padding: 24px;
      font-weight: 500;
      color: #8DCF66;
    }

    .container {
      display: flex;
      gap: 24px;
      padding: 0 24px 24px;
      max-width: 1400px;
      margin: 0 auto;
    }

    /* ì¢Œì¸¡: JSON ì…ë ¥ */
    .input-section {
      flex: 1;
      min-width: 400px;
    }

    .input-section h2 {
      margin-bottom: 12px;
      font-weight: 500;
    }

    /* ì—ë””í„° ì»¨í…Œì´ë„ˆ (ì˜¤ë²„ë ˆì´ìš©) */
    .editor-container {
      position: relative;
      width: 100%;
      height: 500px;
    }

    .editor-backdrop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #252540;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow: auto;
      color: transparent;
      pointer-events: none;
      box-sizing: border-box;
      z-index: 1;
    }

    .editor-backdrop .highlight-warning {
      background: rgba(240, 173, 78, 0.3);
      border-radius: 2px;
      color: transparent;
    }

    .input-section textarea {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      color: #eee;
      border: 1px solid #444;
      border-radius: 8px;
      padding: 16px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 13px;
      line-height: 1.5;
      resize: none;
      box-sizing: border-box;
      caret-color: #eee;
      z-index: 2;
    }

    .input-section textarea:focus {
      outline: none;
      border-color: #8DCF66;
    }

    .input-section textarea:focus + .editor-backdrop,
    .input-section textarea:focus ~ .editor-backdrop {
      border-color: #8DCF66;
    }

    .input-section textarea::placeholder {
      color: #666;
    }

    /* ë²„íŠ¼ ê·¸ë£¹ */
    .button-group {
      margin-top: 12px;
      display: flex;
      gap: 8px;
    }

    button {
      background: #8DCF66;
      color: #000;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      font-size: 14px;
      transition: background 0.2s;
    }

    button:hover {
      background: #7bc156;
    }

    /* ìš°ì¸¡: í•„ë“œë³„ ê²°ê³¼ */
    .result-section {
      flex: 1;
      min-width: 400px;
    }

    .result-section h2 {
      margin-bottom: 12px;
      font-weight: 500;
    }

    .empty-state {
      color: #666;
      padding: 24px;
      text-align: center;
      background: #252540;
      border-radius: 8px;
    }

    /* JSON ë¬¸ë²• ì—ëŸ¬ */
    .json-error {
      background: #3a2020;
      border: 1px solid #ff6b6b;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
    }

    .json-error-title {
      color: #ff6b6b;
      font-weight: 500;
      margin-bottom: 8px;
    }

    .json-error-message {
      font-family: monospace;
      font-size: 12px;
      color: #ffaaaa;
    }

    .error-context {
      margin-top: 12px;
      background: #1a1a2e;
      border-radius: 6px;
      padding: 12px;
    }

    .error-location {
      color: #ff6b6b;
      font-size: 12px;
      margin-bottom: 8px;
      font-weight: 500;
    }

    .code-preview {
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      line-height: 1.5;
    }

    .code-line {
      display: flex;
      white-space: pre;
    }

    .code-line .line-num {
      color: #666;
      width: 30px;
      text-align: right;
      margin-right: 12px;
      user-select: none;
    }

    .code-line .line-content {
      color: #aaa;
    }

    .code-line.error-line .line-content {
      color: #fff;
    }

    .error-char {
      background: #ff6b6b;
      color: #fff;
      padding: 0 2px;
      border-radius: 2px;
    }

    .error-pointer {
      display: flex;
      color: #ff6b6b;
      font-size: 11px;
    }

    .error-pointer .line-num {
      width: 30px;
      margin-right: 12px;
    }

    .error-pointer .pointer {
      white-space: pre;
    }

    /* í•„ë“œ ì•„ì´í…œ */
    .field-item {
      background: #252540;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 8px;
      border-left: 4px solid;
    }

    .field-item.valid {
      border-color: #8DCF66;
    }

    .field-item.invalid {
      border-color: #ff6b6b;
    }

    .field-item.warning {
      border-color: #f0ad4e;
    }

    .field-item.redundant {
      border-color: #888;
    }

    .field-item.skipped {
      border-color: #666;
      opacity: 0.6;
    }

    .field-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 4px;
    }

    .field-name {
      font-weight: 500;
      font-family: monospace;
      font-size: 14px;
    }

    .field-status {
      font-size: 16px;
    }

    .type-badge {
      background: #3a5a3a;
      color: #8DCF66;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-family: 'Consolas', 'Monaco', monospace;
    }

    .type-badge.type-error {
      background: #5a3a3a;
      color: #ff6b6b;
    }

    /* ì¤‘ì²© í•„ë“œ (options í•˜ìœ„) ìŠ¤íƒ€ì¼ */
    .field-item.nested {
      margin-left: 20px;
      border-left-width: 3px;
      background: #1e1e35;
    }

    .field-item.nested .field-name {
      color: #aaa;
    }

    .field-desc {
      color: #888;
      font-size: 12px;
      margin-bottom: 8px;
    }

    .field-value {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .field-value code {
      background: #1a1a2e;
      padding: 4px 8px;
      border-radius: 4px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 12px;
      max-width: 100%;
      overflow-x: auto;
      word-break: break-all;
    }

    .default-badge {
      background: #444;
      color: #aaa;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      text-transform: uppercase;
    }

    .field-error {
      color: #ff6b6b;
      margin-top: 8px;
      font-size: 13px;
    }

    .field-warning {
      color: #f0ad4e;
      margin-top: 8px;
      font-size: 12px;
    }

    .field-warning::before {
      content: 'ğŸ’¡ ';
    }

    .field-redundant {
      color: #888;
      margin-top: 8px;
      font-size: 12px;
    }

    .redundant-badge {
      background: #555;
      color: #ccc;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 10px;
      margin-left: 8px;
    }

    /* ì „ì²´ ê²°ê³¼ ìš”ì•½ */
    .result-summary {
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 16px;
      font-weight: 500;
    }

    .result-summary.success {
      background: #203a20;
      border: 1px solid #8DCF66;
      color: #8DCF66;
    }

    .result-summary.error {
      background: #3a2020;
      border: 1px solid #ff6b6b;
      color: #ff6b6b;
    }

    .result-summary.warning {
      background: #3a3520;
      border: 1px solid #f0ad4e;
      color: #f0ad4e;
    }

    .recommendations-section {
      margin-bottom: 16px;
    }

    /* ë¯¸ë¦¬ë³´ê¸° (JSON ì…ë ¥ ì•„ë˜) */
    .preview-section {
      margin-top: 16px;
    }

    .preview-section h3 {
      margin-bottom: 12px;
      font-weight: 500;
      font-size: 14px;
      color: #888;
    }

    #previewContainer {
      background: #252540;
      border-radius: 8px;
      padding: 16px;
    }

    #previewContainer canvas {
      display: block;
      margin: 0 auto;
    }

    /* ìŠ¤í¬ë¡¤ë°” ìŠ¤íƒ€ì¼ */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #1a1a2e;
    }

    ::-webkit-scrollbar-thumb {
      background: #444;
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* ì‚¬ì´ë“œ íŒ¨ë„ ë²„íŠ¼ ê·¸ë£¹ */
    .guide-btn-group {
      position: fixed;
      top: 24px;
      right: 24px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 100;
    }

    .guide-toggle-btn {
      background: #3a3a5a;
      color: #aaa;
      border: 1px solid #555;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-weight: 500;
      font-size: 13px;
      transition: all 0.2s;
      text-align: left;
      white-space: nowrap;
    }

    .guide-toggle-btn:hover {
      background: #4a4a6a;
      color: #fff;
      border-color: #8DCF66;
    }

    .guide-panel {
      position: fixed;
      top: 0;
      right: -420px;
      width: 400px;
      height: 100vh;
      background: #252540;
      border-left: 1px solid #444;
      box-shadow: -4px 0 20px rgba(0,0,0,0.3);
      transition: right 0.3s ease;
      z-index: 200;
      display: flex;
      flex-direction: column;
    }

    .guide-panel.open {
      right: 0;
    }

    .guide-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid #444;
      background: #1a1a2e;
    }

    .guide-panel-header h3 {
      font-weight: 500;
      color: #8DCF66;
      font-size: 16px;
    }

    .guide-close-btn {
      background: none;
      border: none;
      color: #888;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .guide-close-btn:hover {
      color: #fff;
    }

    .guide-panel-content {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .guide-section {
      margin-bottom: 24px;
    }

    .guide-section h4 {
      color: #8DCF66;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid #3a3a5a;
    }

    .guide-item {
      background: #1a1a2e;
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 8px;
    }

    .guide-item-title {
      color: #f0ad4e;
      font-weight: 500;
      font-size: 13px;
      margin-bottom: 6px;
    }

    .guide-item-desc {
      color: #aaa;
      font-size: 12px;
      line-height: 1.5;
    }

    .guide-item code {
      background: #3a3a5a;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Consolas', 'Monaco', monospace;
      font-size: 11px;
      color: #8DCF66;
    }

    /* íŒ¨ë„ ì—´ë ¸ì„ ë•Œ ë°°ê²½ ì˜¤ë²„ë ˆì´ */
    .guide-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s;
      z-index: 150;
    }

    .guide-overlay.open {
      opacity: 1;
      visibility: visible;
    }
  </style>
</head>
<body>
  <!-- ê°€ì´ë“œ ë²„íŠ¼ ê·¸ë£¹ -->
  <div class="guide-btn-group">
    <button class="guide-toggle-btn" id="guideToggleBtn">ê¶Œì¥ì‚¬í•­ ê°€ì´ë“œ</button>
    <button class="guide-toggle-btn" id="chartOptionsBtn">ì°¨íŠ¸ ì˜µì…˜ ëª¨ìŒ</button>
    <button class="guide-toggle-btn" id="tableOptionsBtn">í…Œì´ë¸” ì˜µì…˜ ëª¨ìŒ</button>
    <button class="guide-toggle-btn" id="fullJsonBtn">ì „ì²´ ì˜µì…˜ JSON</button>
  </div>

  <!-- ë°°ê²½ ì˜¤ë²„ë ˆì´ -->
  <div class="guide-overlay" id="guideOverlay"></div>

  <!-- ì‚¬ì´ë“œ íŒ¨ë„ -->
  <div class="guide-panel" id="guidePanel">
    <div class="guide-panel-header">
      <h3>ê¶Œì¥ì‚¬í•­ ê°€ì´ë“œ</h3>
      <button class="guide-close-btn" id="guideCloseBtn">&times;</button>
    </div>
    <div class="guide-panel-content">
      <div class="guide-section">
        <h4>ë°ì´í„° ì„¤ì •</h4>
        <div class="guide-item">
          <div class="guide-item-title">í…Œì´ë¸” ë°ì´í„°ì—ëŠ” purpose ëª…ì‹œ</div>
          <div class="guide-item-desc">
            í…Œì´ë¸” í˜•ì‹ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” <code>"purpose": "table"</code>ì„ ëª…ì‹œí•˜ì„¸ìš”.
            ìë™ ê°ì§€ë˜ì§€ë§Œ ëª…ì‹œì  ì„ ì–¸ì´ ì•ˆì „í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">classRange ì‚¬ìš© ì£¼ì˜</div>
          <div class="guide-item-desc">
            <code>classRange</code>ëŠ” ë³µìˆ˜ ë„ìˆ˜ë‹¤ê°í˜• ì˜¤ë²„ë ˆì´ ìš©ë„ë¡œë§Œ ê¶Œì¥ë©ë‹ˆë‹¤.
            ì¼ë°˜ì ì¸ ê²½ìš° <code>classCount</code> + <code>classWidth</code> ì¡°í•©ì„ ì‚¬ìš©í•˜ì„¸ìš”.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">ë„ìˆ˜ë¶„í¬í‘œ ì´ìƒ/ë¯¸ë§Œ í‘œê¸°</div>
          <div class="guide-item-desc">
            ë„ìˆ˜ë¶„í¬í‘œ(basic-table)ì—ì„œ ì²« ë²ˆì§¸ ë°ì´í„° í–‰ì—ë§Œ ìƒì²¨ìë¡œ ì´ìƒ/ë¯¸ë§Œì„ í‘œê¸°í•˜ì„¸ìš”.<br>
            <code>60^{ì´ìƒ}~70^{ë¯¸ë§Œ}: 2, 0.2</code><br>
            ë‚˜ë¨¸ì§€ í–‰ì€ ìˆ«ìë§Œ ì‚¬ìš©: <code>70~80: 5, 0.5</code>
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">showMergedHeader ì„¤ì •</div>
          <div class="guide-item-desc">
            <strong>ë„ìˆ˜ë¶„í¬í‘œ</strong> (~, ^{ì´ìƒ}, ^{ë¯¸ë§Œ} í¬í•¨): <code>showMergedHeader: false</code><br>
            <strong>ì´ì›ë¶„ë¥˜í‘œ</strong> (ìœ„ íŒ¨í„´ ì—†ìŒ): <code>showMergedHeader: true</code>
          </div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ìº”ë²„ìŠ¤ í¬ê¸°</h4>
        <div class="guide-item">
          <div class="guide-item-title">ì°¨íŠ¸: canvasSize ì‚¬ìš©</div>
          <div class="guide-item-desc">
            ì°¨íŠ¸ëŠ” <code>canvasSize</code> í•˜ë‚˜ë¡œ ì •ì‚¬ê°í˜• ê¸°ì¤€ í¬ê¸°ë¥¼ ì„¤ì •í•˜ê±°ë‚˜,
            <code>canvasWidth</code>ì™€ <code>canvasHeight</code>ë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ì„¸ìš”.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">í…Œì´ë¸”: width ë˜ëŠ” height ì¤‘ í•˜ë‚˜ë§Œ</div>
          <div class="guide-item-desc">
            í…Œì´ë¸”ì€ <code>canvasWidth</code> ë˜ëŠ” <code>canvasHeight</code> ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
            ë™ì‹œ ì§€ì • ì‹œ ë¹„ìœ¨ì´ ì™œê³¡ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ì˜µì…˜ ì„¤ì •</h4>
        <div class="guide-item">
          <div class="guide-item-title">callout.preset ìƒëµ ê°€ëŠ¥</div>
          <div class="guide-item-desc">
            <code>callout.preset</code>ì€ ë„ìˆ˜ë‹¤ê°í˜• ìƒ‰ìƒì„ ìë™ìœ¼ë¡œ ë”°ë¥´ë¯€ë¡œ ìƒëµí•´ë„ ë©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">showDashedLines + Yì¶• ë¼ë²¨</div>
          <div class="guide-item-desc">
            <code>showDashedLines</code> ì‚¬ìš© ì‹œ Yì¶• ë¼ë²¨ê³¼ ì¤‘ë³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            <code>axis.showYLabels: false</code>ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">customYInterval ê°’</div>
          <div class="guide-item-desc">
            ë„ìˆ˜ ëª¨ë“œ(<code>dataType: "frequency"</code>)ì—ì„œëŠ” ì •ìˆ˜(1, 2, 5, 10 ë“±),
            ìƒëŒ€ë„ìˆ˜ ëª¨ë“œì—ì„œëŠ” ì†Œìˆ˜(0.05, 0.1 ë“±)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ì• ë‹ˆë©”ì´ì…˜</h4>
        <div class="guide-item">
          <div class="guide-item-title">cellAnimations í•„ìš”</div>
          <div class="guide-item-desc">
            <code>animation: true</code>ë¥¼ ì„¤ì •í–ˆë‹¤ë©´ <code>cellAnimations</code> ë°°ì—´ì„ ì¶”ê°€í•´ì•¼
            ì…€ ì• ë‹ˆë©”ì´ì…˜ì´ ë™ì‘í•©ë‹ˆë‹¤.
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">duration/repeatì€ blink ì „ìš©</div>
          <div class="guide-item-desc">
            <code>duration</code>ê³¼ <code>repeat</code>ì€
            <code>cellAnimationOptions.blinkEnabled: true</code>ì¼ ë•Œë§Œ ì ìš©ë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ê¸°ë³¸ê°’ ì°¸ê³ </h4>
        <div class="guide-item">
          <div class="guide-item-title">ìì£¼ ì“°ëŠ” ê¸°ë³¸ê°’</div>
          <div class="guide-item-desc">
            <code>purpose</code>: "chart"<br>
            <code>classCount</code>: 5<br>
            <code>canvasWidth</code>: 700<br>
            <code>canvasHeight</code>: 450<br>
            <code>animation</code>: true<br>
            ê¸°ë³¸ê°’ê³¼ ë™ì¼í•œ ê°’ì€ ìƒëµí•´ë„ ë©ë‹ˆë‹¤.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì°¨íŠ¸ ì˜µì…˜ íŒ¨ë„ -->
  <div class="guide-panel" id="chartOptionsPanel">
    <div class="guide-panel-header">
      <h3>ì°¨íŠ¸ ì˜µì…˜ ëª¨ìŒ</h3>
      <button class="guide-close-btn" data-close-panel>&times;</button>
    </div>
    <div class="guide-panel-content">
      <div class="guide-section">
        <h4>ê¸°ë³¸ ì„¤ì •</h4>
        <div class="guide-item">
          <div class="guide-item-title">data</div>
          <div class="guide-item-desc">ìˆ«ì ë°°ì—´ (í•„ìˆ˜)<br><code>[62, 87, 97, 73, 59, 85]</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">classCount</div>
          <div class="guide-item-desc">ê³„ê¸‰ ê°œìˆ˜ (ê¸°ë³¸: 5, ë²”ìœ„: 3~20)<br><code>"classCount": 6</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">classWidth</div>
          <div class="guide-item-desc">ê³„ê¸‰ ê°„ê²© (ìë™ ê³„ì‚°ë¨)<br><code>"classWidth": 10</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">classRange</div>
          <div class="guide-item-desc">ê³„ê¸‰ ë²”ìœ„ ìˆ˜ë™ ì§€ì •<br><code>"classRange": { "firstStart": 12, "secondStart": 14, "lastEnd": 22 }</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ìº”ë²„ìŠ¤ í¬ê¸°</h4>
        <div class="guide-item">
          <div class="guide-item-title">canvasSize</div>
          <div class="guide-item-desc">ì •ì‚¬ê°í˜• ê¸°ì¤€ í¬ê¸° (ìš°ì„  ì ìš©)<br><code>"canvasSize": 600</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">canvasWidth / canvasHeight</div>
          <div class="guide-item-desc">ë„ˆë¹„/ë†’ì´ ê°œë³„ ì§€ì •<br><code>"canvasWidth": 700, "canvasHeight": 450</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>options í•˜ìœ„</h4>
        <div class="guide-item">
          <div class="guide-item-title">showHistogram / showPolygon</div>
          <div class="guide-item-desc">íˆìŠ¤í† ê·¸ë¨/ë„ìˆ˜ë‹¤ê°í˜• í‘œì‹œ (ê¸°ë³¸: true)<br><code>"showHistogram": false</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">dataType</div>
          <div class="guide-item-desc">Yì¶• íƒ€ì…: <code>"frequency"</code> ë˜ëŠ” <code>"relativeFrequency"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">histogramColorPreset / polygonColorPreset</div>
          <div class="guide-item-desc">ìƒ‰ìƒ í”„ë¦¬ì…‹: <code>"default"</code>, <code>"primary"</code>, <code>"secondary"</code>, <code>"tertiary"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">histogramColor / polygonColor</div>
          <div class="guide-item-desc">ì§ì ‘ ìƒ‰ìƒ ì§€ì •<br><code>"histogramColor": { "fill": "#8DCF66", "border": "#5a9a3d" }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">axisLabels</div>
          <div class="guide-item-desc">ì¶• ë¼ë²¨<br><code>"axisLabels": { "xAxis": "ì ìˆ˜", "yAxis": "ë„ìˆ˜" }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">grid</div>
          <div class="guide-item-desc">ê²©ìì„ <br><code>"grid": { "showHorizontal": true, "showVertical": false }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">axis</div>
          <div class="guide-item-desc">ì¶• ì„¤ì •<br><code>"axis": { "showYLabels": true, "showXLabels": true }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">customYInterval</div>
          <div class="guide-item-desc">Yì¶• ê°„ê²© ì»¤ìŠ¤í…€<br><code>"customYInterval": 2</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">showDashedLines</div>
          <div class="guide-item-desc">ìˆ˜ì§ íŒŒì„  í‘œì‹œ<br><code>"showDashedLines": true</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">callout</div>
          <div class="guide-item-desc">ë§í’ì„ <br><code>"callout": { "enabled": true, "template": "ë‚¨í•™ìƒ" }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">congruentTriangles</div>
          <div class="guide-item-desc">í•©ë™ ì‚¼ê°í˜•<br><code>"congruentTriangles": { "enabled": true, "boundary": 75 }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">triangleLabels</div>
          <div class="guide-item-desc">í•©ë™ì‚¼ê°í˜• ë¼ë²¨<br><code>"triangleLabels": ["Sâ‚", "Sâ‚‚"]</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">customBarLabels</div>
          <div class="guide-item-desc">ë§‰ëŒ€ ë‚´ë¶€ ë¼ë²¨<br><code>"customBarLabels": ["A", null, "B"]</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">corruption (ì°¨íŠ¸)</div>
          <div class="guide-item-desc">ì°¢ê¹€ íš¨ê³¼<br><code>"corruption": { "enabled": true, "cells": "0-1:2-3", "maskAxisLabels": true }</code></div>
        </div>
      </div>
    </div>
  </div>

  <!-- í…Œì´ë¸” ì˜µì…˜ íŒ¨ë„ -->
  <div class="guide-panel" id="tableOptionsPanel">
    <div class="guide-panel-header">
      <h3>í…Œì´ë¸” ì˜µì…˜ ëª¨ìŒ</h3>
      <button class="guide-close-btn" data-close-panel>&times;</button>
    </div>
    <div class="guide-panel-content">
      <div class="guide-section">
        <h4>ê¸°ë³¸ ì„¤ì •</h4>
        <div class="guide-item">
          <div class="guide-item-title">purpose</div>
          <div class="guide-item-desc">í…Œì´ë¸”ì€ ë°˜ë“œì‹œ ëª…ì‹œ<br><code>"purpose": "table"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">tableType</div>
          <div class="guide-item-desc">
            <code>"basic-table"</code> - ë„ìˆ˜ë¶„í¬í‘œ (ê¸°ë³¸)<br>
            <code>"category-matrix"</code> - ì¹´í…Œê³ ë¦¬ êµì°¨í‘œ<br>
            <code>"stem-leaf"</code> - ì¤„ê¸°-ì ê·¸ë¦¼
          </div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">data (basic-table: ì¼ë°˜)</div>
          <div class="guide-item-desc"><code>"í—¤ë”: í•­ëª©, ê°’\nA: 10\nB: 20"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">data (basic-table: ë„ìˆ˜ë¶„í¬í‘œ)</div>
          <div class="guide-item-desc"><code>"í—¤ë”: ê³„ê¸‰(ì ), ë„ìˆ˜(ëª…)\n60^{ì´ìƒ}~70^{ë¯¸ë§Œ}: 2\n70~80: 5\n80~90: 3"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">data (category-matrix)</div>
          <div class="guide-item-desc"><code>"í—¤ë”: A, B, C, D, E\nì „ì²´ í•™ìƒ ìˆ˜ (ëª…): 200, 250, 300, 350, 400\nOí˜•ì¸ í•™ìƒ ìˆ˜ (ëª…): 50, 60, 70, 80, 90"</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">data (stem-leaf)</div>
          <div class="guide-item-desc"><code>"162 178 175 183"</code> ë˜ëŠ” <code>"ë‚¨: 162 178\nì—¬: 165 172"</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ìº”ë²„ìŠ¤ í¬ê¸°</h4>
        <div class="guide-item">
          <div class="guide-item-title">canvasWidth / canvasHeight</div>
          <div class="guide-item-desc">ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš© ê¶Œì¥<br><code>"canvasWidth": 500</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>ì…€ ê´€ë ¨</h4>
        <div class="guide-item">
          <div class="guide-item-title">cellVariables</div>
          <div class="guide-item-desc">ì…€ ê°’ ë³€ê²½ (ìµœìƒìœ„ ë ˆë²¨!)<br><code>"cellVariables": [{ "rowIndex": 1, "colIndex": 2, "value": "?" }]</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">cellAnimations</div>
          <div class="guide-item-desc">ì…€ í•˜ì´ë¼ì´íŠ¸<br><code>"cellAnimations": [{ "rowIndex": 1, "colIndex": 2 }]</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">cellAnimationOptions</div>
          <div class="guide-item-desc">ì• ë‹ˆë©”ì´ì…˜ ì „ì—­ ì˜µì…˜<br><code>"cellAnimationOptions": { "blinkEnabled": true }</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>options í•˜ìœ„ (basic-table)</h4>
        <div class="guide-item">
          <div class="guide-item-title">showTotal</div>
          <div class="guide-item-desc">í•©ê³„ í–‰ í‘œì‹œ<br><code>"options": { "showTotal": true }</code></div>
        </div>
        <div class="guide-item">
          <div class="guide-item-title">showMergedHeader</div>
          <div class="guide-item-desc">ë³‘í•© í—¤ë” í‘œì‹œ<br><code>"options": { "showMergedHeader": true }</code></div>
        </div>
      </div>

      <div class="guide-section">
        <h4>Corruption (ì°¢ê¹€ íš¨ê³¼)</h4>
        <div class="guide-item">
          <div class="guide-item-title">corruption</div>
          <div class="guide-item-desc">
            <code>"options": { "corruption": { "enabled": true, "cells": "1-1:2-3" } }</code><br>
            ì…€ ë²”ìœ„: <code>"í–‰-ì—´:í–‰-ì—´"</code> í˜•ì‹
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ì „ì²´ ì˜µì…˜ JSON íŒ¨ë„ -->
  <div class="guide-panel" id="fullJsonPanel">
    <div class="guide-panel-header">
      <h3>ì „ì²´ ì˜µì…˜ JSON</h3>
      <button class="guide-close-btn" data-close-panel>&times;</button>
    </div>
    <div class="guide-panel-content">
      <div class="guide-section">
        <h4>ì°¨íŠ¸ ì „ì²´ ì˜µì…˜</h4>
        <div class="guide-item">
          <pre style="font-size: 11px; line-height: 1.4; color: #8DCF66; overflow-x: auto;">{
  "purpose": "chart",
  "data": [62, 87, 97, 73, 59, 85, 80, 79, 65, 75, 68, 91, 83, 72, 78],
  "classCount": 5,
  "classWidth": 10,
  "canvasSize": 600,
  "animation": true,
  "options": {
    "showHistogram": true,
    "showPolygon": true,
    "dataType": "frequency",
    "axisLabels": {
      "xAxis": "(ì )",
      "yAxis": "(ëª…)"
    },
    "histogramColor": {
      "fill": "linear-gradient(180deg, rgba(174, 255, 126, 0.3) 0%, rgba(104, 153, 76, 0.3) 100%)",
      "stroke": "linear-gradient(180deg, #AEFF7E 0%, #68994C 100%)",
      "alpha": 0.3
    },
    "polygonColor": {
      "line": "linear-gradient(180deg, #54A0F6 0%, #6DE0FC 100%)",
      "point": "#61C1F9"
    },
    "callout": {
      "enabled": true,
      "template": "ë‚¨í•™ìƒ",
      "preset": "primary"
    },
    "showDashedLines": true,
    "grid": {
      "showHorizontal": true,
      "showVertical": false
    },
    "axis": {
      "showYLabels": false,
      "showXLabels": true,
      "yLabelFormat": "percent"
    },
    "congruentTriangles": {
      "enabled": true,
      "boundary": 70
    },
    "triangleLabels": ["Sâ‚", "Sâ‚‚"],
    "customYInterval": 1,
    "customBarLabels": ["A", null, "B", null, "C"]
  }
}</pre>
        </div>
      </div>

      <div class="guide-section">
        <h4>í…Œì´ë¸” ì „ì²´ ì˜µì…˜ (basic-table ë„ìˆ˜ë¶„í¬í‘œ)</h4>
        <div class="guide-item">
          <pre style="font-size: 11px; line-height: 1.4; color: #8DCF66; overflow-x: auto;">{
  "purpose": "table",
  "tableType": "basic-table",
  "data": "í—¤ë”: í‚¤(cm), ë„ìˆ˜(ëª…), ìƒëŒ€ë„ìˆ˜\n60^{ì´ìƒ}~70^{ë¯¸ë§Œ}: 2, 0.2\n70~80: 5, 0.5\n80~90: 3, 0.3",
  "canvasWidth": 500,
  "animation": true,
  "options": {
    "showTotal": true,
    "showMergedHeader": false
  },
  "cellVariables": [
    { "rowIndex": 2, "colIndex": 1, "value": "?" }
  ],
  "cellAnimations": [
    { "rowIndex": 2, "colIndex": 1, "duration": 1500, "repeat": 3 }
  ],
  "cellAnimationOptions": {
    "blinkEnabled": true
  }
}</pre>
        </div>
      </div>

      <div class="guide-section">
        <h4>í…Œì´ë¸” ì „ì²´ ì˜µì…˜ (basic-table ì´ì›ë¶„ë¥˜í‘œ)</h4>
        <div class="guide-item">
          <pre style="font-size: 11px; line-height: 1.4; color: #8DCF66; overflow-x: auto;">{
  "purpose": "table",
  "tableType": "basic-table",
  "data": "ë¹„ìœ¨\ní—¤ë”: í˜ˆì•¡í˜•, ë‚¨í•™ìƒ, ì—¬í•™ìƒ\nA: 0.4, 0.3\nB: 0.22, 0.2\nAB: 0.12, ?\nO: 0.26, 0.24",
  "canvasWidth": 400,
  "animation": true,
  "options": {
    "showTotal": true,
    "showMergedHeader": true
  },
  "cellVariables": [
    { "rowIndex": 3, "colIndex": 2, "value": "0.26" }
  ],
  "cellAnimations": [
    { "rowIndex": 3, "colIndex": 2, "duration": 1500, "repeat": 3 }
  ],
  "cellAnimationOptions": {
    "blinkEnabled": true
  }
}</pre>
        </div>
      </div>

      <div class="guide-section">
        <h4>í…Œì´ë¸” ì „ì²´ ì˜µì…˜ (category-matrix)</h4>
        <div class="guide-item">
          <pre style="font-size: 11px; line-height: 1.4; color: #8DCF66; overflow-x: auto;">{
  "purpose": "table",
  "tableType": "category-matrix",
  "data": "í—¤ë”: A, B, C, D, E\nì „ì²´ í•™ìƒ ìˆ˜ (ëª…): 200, 250, null, 350, 400\nOí˜•ì¸ í•™ìƒ ìˆ˜ (ëª…): 50, ?, 70, 80, 90",
  "canvasWidth": 800,
  "canvasHeight": 300,
  "animation": true,
  "cellAnimations": [
    { "rowIndex": 1, "colIndex": 2, "duration": 1500, "repeat": 3 },
    { "rowIndex": 2, "colIndex": 2, "duration": 1500, "repeat": 3 }
  ],
  "cellAnimationOptions": {
    "blinkEnabled": true
  },
  "cellVariables": [
    { "rowIndex": 1, "colIndex": 3, "value": "300" },
    { "rowIndex": 2, "colIndex": 2, "value": "60" }
  ]
}</pre>
        </div>
      </div>

      <div class="guide-section">
        <h4>í…Œì´ë¸” ì „ì²´ ì˜µì…˜ (stem-leaf)</h4>
        <div class="guide-item">
          <pre style="font-size: 11px; line-height: 1.4; color: #8DCF66; overflow-x: auto;">{
  "purpose": "table",
  "tableType": "stem-leaf",
  "data": "ë‚¨í•™ìƒ: 162 178 175 174 189 186 183 183 181 197 194 191 190 209 205\nì—¬í•™ìƒ: 160 165 170 177 180 182 184 188 192 193 196 201 207",
  "canvasWidth": 500,
  "animation": true,
  "cellVariables": [
    { "rowIndex": 2, "colIndex": 1, "value": ["x", 5, 8] }
  ]
}</pre>
        </div>
      </div>
    </div>
  </div>

  <h1>Statistics JSON ë™ì‘ ê²€ì¦ê¸°</h1>

  <div class="container">
    <!-- ì¢Œì¸¡: JSON ì…ë ¥ -->
    <div class="input-section">
      <h2>JSON ì…ë ¥</h2>
      <div class="editor-container">
        <textarea id="jsonInput" placeholder='{
  "data": [62, 87, 97, 73, 59],
  "classCount": 5,
  "options": {
    "showHistogram": true,
    "showPolygon": true
  }
}'></textarea>
        <div class="editor-backdrop" id="editorBackdrop"></div>
      </div>
      <div class="button-group">
        <button id="validateBtn">ê²€ì¦í•˜ê¸°</button>
      </div>

      <!-- ë¯¸ë¦¬ë³´ê¸° (JSON ì…ë ¥ ì•„ë˜) -->
      <div class="preview-section" id="previewSection" style="display:none">
        <h3>ë¯¸ë¦¬ë³´ê¸°</h3>
        <div id="previewContainer"></div>
      </div>
    </div>

    <!-- ìš°ì¸¡: í•„ë“œë³„ ê²°ê³¼ -->
    <div class="result-section">
      <h2>í•„ë“œë³„ ê²€ì¦ ê²°ê³¼</h2>
      <div id="fieldResults">
        <div class="empty-state">
          JSONì„ ì…ë ¥í•˜ê³  ê²€ì¦í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { ConfigValidator } from './js/utils/validator.js';
    import * as VizAPI from './js/viz-api.js';

    // ê¶Œì¥ì‚¬í•­ ì²´í¬ í•¨ìˆ˜ë“¤
    const RECOMMENDATIONS = {
      // í…Œì´ë¸”ì¸ë° purpose ëª…ì‹œ ì•ˆí•¨
      missingTablePurpose: (config) => {
        if (config.purpose) return null;
        const tablePatterns = ['í—¤ë”:', 'í—¤ë” :', 'Header:', 'header:'];
        const looksLikeTable = typeof config.data === 'string' &&
          tablePatterns.some(p => config.data.includes(p));
        if (looksLikeTable) {
          return {
            message: 'í…Œì´ë¸” ë°ì´í„°ë¡œ ë³´ì…ë‹ˆë‹¤. "purpose": "table" ëª…ì‹œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['purpose']
          };
        }
        return null;
      },

      // classRange ì‚¬ìš© ë¹„ê¶Œì¥ (datasets ì‚¬ìš© ì‹œì—ëŠ” ê¶Œì¥)
      classRangeUsage: (config) => {
        // datasets ì‚¬ìš© ì‹œì—ëŠ” classRangeê°€ í•„ìˆ˜
        if (config.datasets && config.datasets.length > 0) return null;
        if (config.classRange) {
          return {
            message: 'classRangeëŠ” ë³µìˆ˜ ë„ìˆ˜ë‹¤ê°í˜• ì˜¤ë²„ë ˆì´ ìš©ë„ë¡œë§Œ ê¶Œì¥ë©ë‹ˆë‹¤. ì¼ë°˜ì ì¸ ê²½ìš° classCount + classWidth ì¡°í•©ì„ ì‚¬ìš©í•˜ì„¸ìš”.',
            fields: ['classRange']
          };
        }
        return null;
      },

      // datasets ì‚¬ìš© ì‹œ showHistogram: false ê¶Œì¥
      datasetsHistogram: (config) => {
        if (config.datasets && config.datasets.length > 0) {
          if (config.options?.showHistogram !== false) {
            return {
              message: 'datasets ì‚¬ìš© ì‹œ íˆìŠ¤í† ê·¸ë¨ì´ ê²¹ì³ ë³´ì…ë‹ˆë‹¤. "options.showHistogram": false ê¶Œì¥í•©ë‹ˆë‹¤.',
              fields: ['datasets', 'options.showHistogram']
            };
          }
        }
        return null;
      },

      // datasets + data ë™ì‹œ ì‚¬ìš© ê²½ê³ 
      datasetsWithData: (config) => {
        if (config.datasets && config.datasets.length > 0 && config.data) {
          return {
            message: 'datasets ì‚¬ìš© ì‹œ data í•„ë“œëŠ” ë¬´ì‹œë©ë‹ˆë‹¤. dataë¥¼ ì œê±°í•˜ì„¸ìš”.',
            fields: ['data', 'datasets']
          };
        }
        return null;
      },

      // ìº”ë²„ìŠ¤ í¬ê¸° ê¶Œì¥ì‚¬í•­
      canvasSizeRecommendation: (config) => {
        const purpose = config.purpose || 'chart';

        // canvasWidthì™€ canvasHeight ë™ì‹œ ì‚¬ìš©
        if (config.canvasWidth && config.canvasHeight && !config.canvasSize) {
          if (purpose === 'table') {
            return {
              message: 'í…Œì´ë¸”ì€ canvasWidth ë˜ëŠ” canvasHeight ë‘˜ ì¤‘ í•˜ë‚˜ë§Œ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤. ë™ì‹œ ì§€ì • ì‹œ ë¹„ìœ¨ì´ ì™œê³¡ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
              fields: ['canvasWidth', 'canvasHeight']
            };
          }
        }

        // í…Œì´ë¸”ì¸ë° canvasSize ì‚¬ìš©
        if (purpose === 'table' && config.canvasSize) {
          return {
            message: 'í…Œì´ë¸”ì€ canvasWidth ë˜ëŠ” canvasHeight ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['canvasSize']
          };
        }

        return null;
      },

      // callout.preset ë¶ˆí•„ìš”
      calloutPreset: (config) => {
        if (config.options?.callout?.preset) {
          return {
            message: 'callout.presetì€ ë„ìˆ˜ë‹¤ê°í˜• ìƒ‰ìƒì„ ìë™ìœ¼ë¡œ ë”°ë¥´ë¯€ë¡œ ìƒëµí•´ë„ ë©ë‹ˆë‹¤.',
            fields: ['options.callout']
          };
        }
        return null;
      },

      // showDashedLines + showYLabels
      dashedLinesYLabels: (config) => {
        if (config.options?.showDashedLines && config.options?.axis?.showYLabels !== false) {
          return {
            message: 'showDashedLines ì‚¬ìš© ì‹œ Yì¶• ë¼ë²¨ê³¼ ì¤‘ë³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. axis.showYLabels: false ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['options.showDashedLines', 'options.axis']
          };
        }
        return null;
      },

      // blinkEnabled ì—†ì´ duration/repeat ì‚¬ìš©
      cellAnimationBlink: (config) => {
        const anims = config.cellAnimations || config.options?.cellAnimations;
        if (!anims) return null;

        const hasTimingWithoutBlink = anims.some(a =>
          (a.duration || a.repeat) &&
          !config.cellAnimationOptions?.blinkEnabled
        );

        if (hasTimingWithoutBlink) {
          return {
            message: 'duration/repeatì€ cellAnimationOptions.blinkEnabled: trueì¼ ë•Œë§Œ ì ìš©ë©ë‹ˆë‹¤.',
            fields: ['cellAnimations']
          };
        }
        return null;
      },

      // animation: trueì¸ë° cellAnimations ì—†ìŒ (í…Œì´ë¸” ì „ìš©)
      animationWithoutCellAnimations: (config) => {
        // í…Œì´ë¸”ì¼ ë•Œë§Œ í•´ë‹¹ë˜ëŠ” ê²€ì¦
        if (config.purpose !== 'table') return null;

        const animation = config.animation;
        const hasAnimation = animation === true || animation?.enabled === true;
        const hasCellAnimations = config.cellAnimations && config.cellAnimations.length > 0;

        if (hasAnimation && !hasCellAnimations) {
          return {
            message: 'animationì´ í™œì„±í™”ë˜ì–´ ìˆì§€ë§Œ cellAnimationsê°€ ì—†ìŠµë‹ˆë‹¤. ì…€ ì• ë‹ˆë©”ì´ì…˜ì„ ì‚¬ìš©í•˜ë ¤ë©´ cellAnimationsë¥¼ ì¶”ê°€í•˜ì„¸ìš”.',
            fields: ['animation', 'cellAnimations']
          };
        }
        return null;
      },

      // customYInterval ê¶Œì¥ ê°’
      customYInterval: (config) => {
        const interval = config.options?.customYInterval;
        if (!interval) return null;

        const dataType = config.options?.dataType || 'relativeFrequency';
        if (dataType === 'frequency' && !Number.isInteger(interval)) {
          return {
            message: 'ë„ìˆ˜ ëª¨ë“œì—ì„œ customYIntervalì€ ì •ìˆ˜(1, 2, 5, 10 ë“±)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['options.customYInterval']
          };
        }
        if (dataType === 'relativeFrequency' && interval >= 1) {
          return {
            message: 'ìƒëŒ€ë„ìˆ˜ ëª¨ë“œì—ì„œ customYIntervalì€ ì†Œìˆ˜(0.05, 0.1 ë“±)ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['options.customYInterval']
          };
        }
        return null;
      },

      // í…Œì´ë¸” data ì²« í–‰ì— ì´ìƒ/ë¯¸ë§Œ í‘œê¸° ê¶Œì¥ (basic-table ë„ìˆ˜ë¶„í¬í‘œ ì „ìš©)
      tableFirstRowNotation: (config) => {
        if (config.purpose !== 'table') return null;
        const tableType = config.tableType || 'basic-table';
        if (tableType !== 'basic-table') return null;

        const data = config.data;
        if (typeof data !== 'string') return null;

        const lines = data.split('\n').filter(line => line.trim());
        if (lines.length < 2) return null;

        // ì²« ë²ˆì§¸ ë°ì´í„° í–‰ (í—¤ë” ë‹¤ìŒ)
        const firstDataLine = lines[1];

        // ë„ìˆ˜ë¶„í¬í‘œ í˜•íƒœì¸ì§€ í™•ì¸ (~ê°€ í¬í•¨ë˜ì–´ ìˆìœ¼ë©´ ë„ìˆ˜ë¶„í¬í‘œ)
        if (!firstDataLine.includes('~')) return null;

        // ì´ìƒ/ë¯¸ë§Œ í‘œê¸°ê°€ ìˆëŠ”ì§€ í™•ì¸ (^{ì´ìƒ}, ^{ë¯¸ë§Œ}, _{ì´ìƒ}, _{ë¯¸ë§Œ} ë“±)
        const hasNotation = /[\^_]\{(ì´ìƒ|ë¯¸ë§Œ)\}/.test(firstDataLine);

        if (!hasNotation) {
          return {
            message: 'í…Œì´ë¸” ì²« ë²ˆì§¸ ë°ì´í„° í–‰ì— "ì´ìƒ/ë¯¸ë§Œ" í‘œê¸°ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤. ì˜ˆ: 60^{ì´ìƒ}~70^{ë¯¸ë§Œ}',
            fields: ['data']
          };
        }
        return null;
      },

      // ë‚˜ë¨¸ì§€ í–‰ì— ì´ìƒ/ë¯¸ë§Œ í…ìŠ¤íŠ¸ê°€ ê·¸ëƒ¥ ì í˜€ìˆìœ¼ë©´ ê²½ê³  (basic-table ë„ìˆ˜ë¶„í¬í‘œ ì „ìš©)
      tableOtherRowsPlainNotation: (config) => {
        if (config.purpose !== 'table') return null;
        const tableType = config.tableType || 'basic-table';
        if (tableType !== 'basic-table') return null;

        const data = config.data;
        if (typeof data !== 'string') return null;

        const lines = data.split('\n').filter(line => line.trim());
        if (lines.length < 2) return null;

        // ì²« ë²ˆì§¸ ë°ì´í„° í–‰ì— ~ê°€ ì—†ìœ¼ë©´ ë„ìˆ˜ë¶„í¬í‘œê°€ ì•„ë‹˜
        const firstDataLine = lines[1];
        if (!firstDataLine.includes('~')) return null;

        if (lines.length < 3) return null;

        // 2ë²ˆì§¸ ë°ì´í„° í–‰ë¶€í„° ê²€ì‚¬ (lines[2] ì´í›„)
        for (let i = 2; i < lines.length; i++) {
          const line = lines[i];
          // ìƒì²¨ì/í•˜ì²¨ì ì—†ì´ "ì´ìƒ" ë˜ëŠ” "ë¯¸ë§Œ"ì´ ê·¸ëƒ¥ ì í˜€ìˆëŠ”ì§€ í™•ì¸
          const hasPlainText = /(ì´ìƒ|ë¯¸ë§Œ)/.test(line) && !/[\^_]\{(ì´ìƒ|ë¯¸ë§Œ)\}/.test(line);

          if (hasPlainText) {
            return {
              message: `${i}ë²ˆì§¸ ë°ì´í„° í–‰ì— "ì´ìƒ/ë¯¸ë§Œ"ì´ ì¼ë°˜ í…ìŠ¤íŠ¸ë¡œ ì í˜€ìˆìŠµë‹ˆë‹¤. ì²« í–‰ì—ë§Œ ^{ì´ìƒ}~^{ë¯¸ë§Œ}ì„ ì‚¬ìš©í•˜ê³ , ë‚˜ë¨¸ì§€ëŠ” ìˆ«ìë§Œ ì‚¬ìš©í•˜ì„¸ìš”.`,
              fields: ['data']
            };
          }
        }
        return null;
      },

      // showMergedHeader ê¶Œì¥ê°’ (ë„ìˆ˜ë¶„í¬í‘œ vs ì´ì›ë¶„ë¥˜í‘œ)
      showMergedHeaderRecommendation: (config) => {
        if (config.purpose !== 'table') return null;
        const tableType = config.tableType || 'basic-table';
        if (tableType !== 'basic-table') return null;

        const data = config.data;
        if (typeof data !== 'string') return null;

        const showMergedHeader = config.options?.showMergedHeader;
        // ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •í•˜ì§€ ì•Šì•˜ìœ¼ë©´ ì²´í¬í•˜ì§€ ì•ŠìŒ
        if (showMergedHeader === undefined) return null;

        // ë„ìˆ˜ë¶„í¬í‘œ íŒë³„: ~ ë˜ëŠ” ^{ì´ìƒ}, ^{ë¯¸ë§Œ} í¬í•¨
        const isFrequencyTable = data.includes('~') || /[\^_]\{(ì´ìƒ|ë¯¸ë§Œ)\}/.test(data);

        if (isFrequencyTable && showMergedHeader === true) {
          return {
            message: 'ë„ìˆ˜ë¶„í¬í‘œì—ì„œëŠ” showMergedHeader: falseë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['options.showMergedHeader']
          };
        }

        if (!isFrequencyTable && showMergedHeader === false) {
          return {
            message: 'ì´ì›ë¶„ë¥˜í‘œì—ì„œëŠ” showMergedHeader: trueë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.',
            fields: ['options.showMergedHeader']
          };
        }

        return null;
      }
    };

    // ì „ì²´ ê¶Œì¥ì‚¬í•­ ì²´í¬
    function checkRecommendations(config) {
      const warnings = [];
      const warningFields = new Set();

      for (const [key, checkFn] of Object.entries(RECOMMENDATIONS)) {
        const result = checkFn(config);
        if (result) {
          warnings.push({ key, message: result.message, fields: result.fields || [] });
          // ê²½ê³  ê´€ë ¨ í•„ë“œë“¤ ìˆ˜ì§‘ (options.xxx í˜•íƒœë„ ì§€ì›)
          (result.fields || []).forEach(f => warningFields.add(f));
        }
      }

      return { warnings, warningFields };
    }

    // ê²€ì¦í•  í•„ë“œ ì •ì˜
    const FIELD_DEFINITIONS = {
      // ìµœìƒìœ„ í•„ë“œ
      data: { required: true, label: 'data', desc: 'ë³€ëŸ‰ ë°ì´í„° (í•„ìˆ˜)', type: 'array|string' },
      datasets: { required: false, label: 'datasets', desc: 'ë³µìˆ˜ ë°ì´í„°ì…‹ ë°°ì—´ (ë³µìˆ˜ ë‹¤ê°í˜•)', type: 'array' },
      purpose: { required: false, label: 'purpose', desc: 'ë Œë”ë§ ëª©ì ', default: 'chart', type: 'string' },
      tableType: { required: false, label: 'tableType', desc: 'í…Œì´ë¸” íƒ€ì…', default: 'basic-table', type: 'string' },
      classCount: { required: false, label: 'classCount', desc: 'ê³„ê¸‰ ê°œìˆ˜ (3~20)', default: 5, type: 'number' },
      classWidth: { required: false, label: 'classWidth', desc: 'ê³„ê¸‰ ê°„ê²©', type: 'number' },
      classRange: { required: false, label: 'classRange', desc: 'ê³„ê¸‰ ë²”ìœ„ ìˆ˜ë™ ì§€ì •', type: 'object' },
      canvasSize: { required: false, label: 'canvasSize', desc: 'ìº”ë²„ìŠ¤ í¬ê¸°', type: 'number' },
      canvasWidth: { required: false, label: 'canvasWidth', desc: 'ìº”ë²„ìŠ¤ ë„ˆë¹„', default: 700, type: 'number' },
      canvasHeight: { required: false, label: 'canvasHeight', desc: 'ìº”ë²„ìŠ¤ ë†’ì´', default: 450, type: 'number' },
      cellVariables: { required: false, label: 'cellVariables', desc: 'ì…€ ë³€ìˆ˜ ì¹˜í™˜', type: 'array' },
      cellAnimations: { required: false, label: 'cellAnimations', desc: 'ì…€ ì• ë‹ˆë©”ì´ì…˜', type: 'array' },
      cellAnimationOptions: { required: false, label: 'cellAnimationOptions', desc: 'ì…€ ì• ë‹ˆë©”ì´ì…˜ ì „ì—­ ì˜µì…˜', type: 'object' },
      animation: { required: false, label: 'animation', desc: 'ì• ë‹ˆë©”ì´ì…˜ í™œì„±í™”', default: true, type: 'boolean' },
      options: { required: false, label: 'options', desc: 'ì„¸ë¶€ ì˜µì…˜', type: 'object' }
    };

    // options í•˜ìœ„ í•„ë“œ ì •ì˜ (ì°¨íŠ¸)
    const OPTIONS_CHART_DEFINITIONS = {
      showHistogram: { label: 'options.showHistogram', desc: 'íˆìŠ¤í† ê·¸ë¨ í‘œì‹œ', default: true, type: 'boolean' },
      showPolygon: { label: 'options.showPolygon', desc: 'ë„ìˆ˜ë‹¤ê°í˜• í‘œì‹œ', default: true, type: 'boolean' },
      dataType: { label: 'options.dataType', desc: 'Yì¶• ë°ì´í„° íƒ€ì…', default: 'relativeFrequency', type: 'string' },
      axisLabels: { label: 'options.axisLabels', desc: 'ì¶• ë¼ë²¨ ì„¤ì •', type: 'object' },
      grid: { label: 'options.grid', desc: 'ê²©ìì„  ì„¤ì •', type: 'object' },
      axis: { label: 'options.axis', desc: 'ì¶• í‘œì‹œ ì„¤ì •', type: 'object' },
      callout: { label: 'options.callout', desc: 'ë§í’ì„  ì„¤ì •', type: 'object' },
      showDashedLines: { label: 'options.showDashedLines', desc: 'ìˆ˜ì§ íŒŒì„  í‘œì‹œ', default: false, type: 'boolean' },
      congruentTriangles: { label: 'options.congruentTriangles', desc: 'í•©ë™ ì‚¼ê°í˜• ì„¤ì •', type: 'object' },
      triangleLabels: { label: 'options.triangleLabels', desc: 'ì‚¼ê°í˜• ë¼ë²¨', type: 'array' },
      customBarLabels: { label: 'options.customBarLabels', desc: 'ë§‰ëŒ€ ë‚´ë¶€ ë¼ë²¨', type: 'array' },
      customYInterval: { label: 'options.customYInterval', desc: 'Yì¶• ê°„ê²©', type: 'number' },
      histogramColorPreset: { label: 'options.histogramColorPreset', desc: 'íˆìŠ¤í† ê·¸ë¨ ìƒ‰ìƒ í”„ë¦¬ì…‹', type: 'string' },
      polygonColorPreset: { label: 'options.polygonColorPreset', desc: 'ë„ìˆ˜ë‹¤ê°í˜• ìƒ‰ìƒ í”„ë¦¬ì…‹', type: 'string' },
      histogramColor: { label: 'options.histogramColor', desc: 'íˆìŠ¤í† ê·¸ë¨ ì§ì ‘ ìƒ‰ìƒ', type: 'object' },
      polygonColor: { label: 'options.polygonColor', desc: 'ë„ìˆ˜ë‹¤ê°í˜• ì§ì ‘ ìƒ‰ìƒ', type: 'object' },
      polygon: { label: 'options.polygon', desc: 'ë‹¤ê°í˜• ì˜µì…˜ (hidden ë“±)', type: 'object' },
      corruption: { label: 'options.corruption', desc: 'ì°¢ê¹€ íš¨ê³¼ ì„¤ì •', type: 'object' }
    };

    // options í•˜ìœ„ í•„ë“œ ì •ì˜ (í…Œì´ë¸”)
    const OPTIONS_TABLE_DEFINITIONS = {
      showTotal: { label: 'options.showTotal', desc: 'í•©ê³„ í–‰ í‘œì‹œ', default: false, type: 'boolean' },
      showMergedHeader: { label: 'options.showMergedHeader', desc: 'ë³‘í•© í—¤ë” í‘œì‹œ', type: 'boolean' },
      corruption: { label: 'options.corruption', desc: 'ì°¢ê¹€ íš¨ê³¼ ì„¤ì •', type: 'object' }
    };

    // íƒ€ì… ê²€ì¦ í•¨ìˆ˜
    function checkType(value, expectedType) {
      if (value === undefined || value === null) return { valid: true, actualType: null };

      const types = expectedType.split('|');
      const actualType = Array.isArray(value) ? 'array' : typeof value;

      const isValid = types.some(t => {
        if (t === 'array') return Array.isArray(value);
        if (t === 'object') return typeof value === 'object' && !Array.isArray(value);
        return typeof value === t;
      });

      return { valid: isValid, actualType, expectedType };
    }

    // íƒ€ì… ì´ë¦„ (ì˜ì–´ + í•œê¸€)
    function getTypeLabel(type, includeKorean = true) {
      const labels = {
        'string': { en: 'string', ko: 'ë¬¸ìì—´' },
        'number': { en: 'number', ko: 'ìˆ«ì' },
        'boolean': { en: 'boolean', ko: 'ë¶ˆë¦¬ì–¸' },
        'array': { en: 'array', ko: 'ë°°ì—´' },
        'object': { en: 'object', ko: 'ê°ì²´' },
        'array|string': { en: 'array|string', ko: 'ë°°ì—´/ë¬¸ìì—´' }
      };
      const label = labels[type];
      if (!label) return type;
      return includeKorean ? `${label.en} (${label.ko})` : label.en;
    }

    // DOM ìš”ì†Œ
    const jsonInput = document.getElementById('jsonInput');
    const editorBackdrop = document.getElementById('editorBackdrop');
    const validateBtn = document.getElementById('validateBtn');
    const fieldResults = document.getElementById('fieldResults');
    const previewSection = document.getElementById('previewSection');
    const previewContainer = document.getElementById('previewContainer');

    // ì—ë””í„° ìŠ¤í¬ë¡¤ ë™ê¸°í™”
    jsonInput.addEventListener('scroll', () => {
      editorBackdrop.scrollTop = jsonInput.scrollTop;
      editorBackdrop.scrollLeft = jsonInput.scrollLeft;
    });

    // ì—ë””í„° ì…ë ¥ ì‹œ backdrop ì—…ë°ì´íŠ¸
    jsonInput.addEventListener('input', () => {
      updateBackdrop([]);
    });

    // backdrop ì—…ë°ì´íŠ¸ (í•˜ì´ë¼ì´íŠ¸ íŒ¨í„´ ì ìš©)
    function updateBackdrop(highlightPatterns) {
      let text = jsonInput.value;

      // HTML ì´ìŠ¤ì¼€ì´í”„
      text = escapeHtml(text);

      // í•˜ì´ë¼ì´íŠ¸ íŒ¨í„´ ì ìš©
      highlightPatterns.forEach(pattern => {
        if (pattern.customReplace) {
          text = pattern.customReplace(text);
        } else if (pattern.regex) {
          text = text.replace(pattern.regex, match =>
            `<span class="highlight-warning">${match}</span>`
          );
        } else if (pattern.text) {
          const escaped = escapeHtml(pattern.text).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
          text = text.replace(new RegExp(escaped, 'g'), match =>
            `<span class="highlight-warning">${match}</span>`
          );
        }
      });

      editorBackdrop.innerHTML = text + '\n'; // ë§ˆì§€ë§‰ ì¤„ë°”ê¿ˆ ì¶”ê°€ (ìŠ¤í¬ë¡¤ ë§ì¶¤)
    }

    // ê¶Œì¥ì‚¬í•­ì—ì„œ í•˜ì´ë¼ì´íŠ¸í•  íŒ¨í„´ ì¶”ì¶œ
    function getHighlightPatterns(config, warnings) {
      const patterns = [];

      warnings.forEach(w => {
        // ë‚˜ë¨¸ì§€ í–‰ì˜ ì´ìƒ/ë¯¸ë§Œ í…ìŠ¤íŠ¸ í•˜ì´ë¼ì´íŠ¸
        if (w.key === 'tableOtherRowsPlainNotation') {
          // "ìˆ«ìì´ìƒ" ë˜ëŠ” "ìˆ«ìë¯¸ë§Œ" í˜•íƒœ (^{ì´ìƒ}ì´ ì•„ë‹Œ ê²ƒ)
          patterns.push({
            customReplace: (text) => {
              return text.replace(/(\d+)(ì´ìƒ|ë¯¸ë§Œ)(?!\})/g, (match) => {
                return `<span class="highlight-warning">${match}</span>`;
              });
            }
          });
        }

        // ìº”ë²„ìŠ¤ í¬ê¸° ê´€ë ¨ ê²½ê³ 
        if (w.key === 'canvasSizeRecommendation') {
          w.fields.forEach(field => {
            // "canvasWidth": ë˜ëŠ” "canvasHeight": íŒ¨í„´ í•˜ì´ë¼ì´íŠ¸
            patterns.push({
              regex: new RegExp(`"${field}"\\s*:\\s*\\d+`, 'g')
            });
          });
        }

        // showMergedHeader ê²½ê³ 
        if (w.key === 'showMergedHeaderRecommendation') {
          patterns.push({
            regex: /"showMergedHeader"\s*:\s*(true|false)/g
          });
        }
      });

      return patterns;
    }

    // ê²€ì¦ í•¨ìˆ˜
    function validateJson() {
      const input = jsonInput.value.trim();

      if (!input) {
        showEmptyState();
        hidePreview();
        updateBackdrop([]);
        return;
      }

      // 1. JSON íŒŒì‹±
      let config;
      try {
        config = JSON.parse(input);
      } catch (e) {
        showJsonSyntaxError(e);
        hidePreview();
        updateBackdrop([]);
        return;
      }

      // 2. ConfigValidatorë¡œ ì „ì²´ ê²€ì¦
      const purpose = config.purpose || 'chart';
      const result = ConfigValidator.validate(config, purpose);

      // 3. ê¶Œì¥ì‚¬í•­ ì²´í¬
      const { warnings, warningFields } = checkRecommendations(config);

      // 4. í•„ë“œë³„ ê²°ê³¼ ìƒì„± ë° ë Œë”ë§
      const fields = buildFieldResults(config, result, warningFields);
      renderFieldResults(fields, result.valid, warnings);

      // 5. ì—ë””í„° í•˜ì´ë¼ì´íŠ¸ ì ìš©
      const highlightPatterns = getHighlightPatterns(config, warnings);
      updateBackdrop(highlightPatterns);

      // 6. ë¯¸ë¦¬ë³´ê¸° (ìœ íš¨í•  ë•Œë§Œ)
      if (result.valid) {
        renderPreview(config, purpose);
      } else {
        hidePreview();
      }
    }

    // ë¹ˆ ìƒíƒœ í‘œì‹œ
    function showEmptyState() {
      fieldResults.innerHTML = `
        <div class="empty-state">
          JSONì„ ì…ë ¥í•˜ê³  ê²€ì¦í•˜ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.
        </div>
      `;
    }

    // JSON ë¬¸ë²• ì—ëŸ¬ í‘œì‹œ
    function showJsonSyntaxError(error) {
      const input = jsonInput.value;
      const errorInfo = parseJsonErrorPosition(error.message, input);

      let errorContextHtml = '';
      if (errorInfo.line !== null) {
        const lines = input.split('\n');
        const startLine = Math.max(0, errorInfo.line - 2);
        const endLine = Math.min(lines.length, errorInfo.line + 2);

        const contextLines = [];
        for (let i = startLine; i < endLine; i++) {
          const lineNum = i + 1;
          const isErrorLine = i === errorInfo.line;
          const lineContent = escapeHtml(lines[i] || '');

          if (isErrorLine) {
            // ì—ëŸ¬ ìœ„ì¹˜ í‘œì‹œ
            const col = errorInfo.column || 0;
            const before = lineContent.substring(0, col);
            const errorChar = lineContent.substring(col, col + 1) || ' ';
            const after = lineContent.substring(col + 1);

            contextLines.push(
              `<div class="code-line error-line">` +
              `<span class="line-num">${lineNum}</span>` +
              `<span class="line-content">${before}<span class="error-char">${errorChar}</span>${after}</span>` +
              `</div>`
            );
            // ì—ëŸ¬ í¬ì¸í„°
            contextLines.push(
              `<div class="error-pointer">` +
              `<span class="line-num"></span>` +
              `<span class="pointer">${' '.repeat(col)}^ ì—¬ê¸°</span>` +
              `</div>`
            );
          } else {
            contextLines.push(
              `<div class="code-line">` +
              `<span class="line-num">${lineNum}</span>` +
              `<span class="line-content">${lineContent}</span>` +
              `</div>`
            );
          }
        }

        errorContextHtml = `
          <div class="error-context">
            <div class="error-location">ì¤„ ${errorInfo.line + 1}, ì—´ ${(errorInfo.column || 0) + 1}</div>
            <div class="code-preview">${contextLines.join('')}</div>
          </div>
        `;
      }

      fieldResults.innerHTML = `
        <div class="json-error">
          <div class="json-error-title">JSON ë¬¸ë²• ì˜¤ë¥˜</div>
          <div class="json-error-message">${escapeHtml(error.message)}</div>
          ${errorContextHtml}
        </div>
        <div class="empty-state">
          JSON ë¬¸ë²•ì„ í™•ì¸í•´ì£¼ì„¸ìš”.
        </div>
      `;
    }

    // JSON ì—ëŸ¬ ë©”ì‹œì§€ì—ì„œ ìœ„ì¹˜ íŒŒì‹±
    function parseJsonErrorPosition(message, input) {
      let position = null;

      // "at position 123" íŒ¨í„´
      const posMatch = message.match(/position\s+(\d+)/i);
      if (posMatch) {
        position = parseInt(posMatch[1], 10);
      }

      // "at line 1 column 5" íŒ¨í„´
      const lineColMatch = message.match(/line\s+(\d+)\s+column\s+(\d+)/i);
      if (lineColMatch) {
        return {
          line: parseInt(lineColMatch[1], 10) - 1,
          column: parseInt(lineColMatch[2], 10) - 1
        };
      }

      // positionìœ¼ë¡œë¶€í„° line/column ê³„ì‚°
      if (position !== null) {
        let line = 0;
        let col = 0;
        for (let i = 0; i < position && i < input.length; i++) {
          if (input[i] === '\n') {
            line++;
            col = 0;
          } else {
            col++;
          }
        }
        return { line, column: col };
      }

      return { line: null, column: null };
    }

    // í•„ë“œë³„ ê²°ê³¼ ìƒì„±
    function buildFieldResults(config, validationResult, warningFields = new Set()) {
      const fields = [];
      const errorMap = new Map(validationResult.errors.map(e => [e.field, e]));
      const purpose = config.purpose || 'chart';
      const hasDatasets = Array.isArray(config.datasets) && config.datasets.length > 0;

      // ìµœìƒìœ„ í•„ë“œ ì²˜ë¦¬
      for (const [key, def] of Object.entries(FIELD_DEFINITIONS)) {
        const hasValue = config.hasOwnProperty(key);
        const value = config[key];
        const error = errorMap.get(key);
        const hasWarning = warningFields.has(key);

        // í…Œì´ë¸” ì „ìš© í•„ë“œ ì²´í¬
        const isTableOnlyField = ['tableType'].includes(key);
        const isChartOnlyField = ['classCount', 'classWidth', 'classRange', 'datasets'].includes(key);

        // ê´€ë ¨ ì—†ëŠ” í•„ë“œëŠ” ìŠ¤í‚µ
        if (purpose === 'chart' && isTableOnlyField && !hasValue) continue;
        if (purpose === 'table' && isChartOnlyField && !hasValue) continue;

        // datasets ì‚¬ìš© ì‹œ data í•„ë“œëŠ” requiredê°€ ì•„ë‹˜
        let isRequired = def.required;
        if (key === 'data' && hasDatasets) {
          isRequired = false;
        }

        // ê¸°ë³¸ê°’ê³¼ ë™ì¼í•œ ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ì…ë ¥í–ˆëŠ”ì§€ ì²´í¬
        const isRedundant = hasValue && def.default !== undefined &&
          JSON.stringify(value) === JSON.stringify(def.default);

        // íƒ€ì… ê²€ì¦
        const typeCheck = hasValue && def.type ? checkType(value, def.type) : { valid: true, actualType: null };

        fields.push({
          name: def.label,
          desc: def.desc,
          hasValue,
          value: hasValue ? value : def.default,
          isDefault: !hasValue && def.default !== undefined,
          isRedundant,
          valid: !error && typeCheck.valid,
          error: error?.message,
          typeError: !typeCheck.valid ? `íƒ€ì… ì˜¤ë¥˜: ${getTypeLabel(def.type)} í•„ìš”, ${getTypeLabel(typeCheck.actualType)} ì…ë ¥ë¨` : null,
          expectedType: def.type,
          actualType: typeCheck.actualType,
          required: isRequired,
          hasWarning,
          isNested: false
        });
      }

      // options í•˜ìœ„ í•„ë“œ ì²˜ë¦¬
      if (config.options && typeof config.options === 'object') {
        const optionsDefs = purpose === 'table' ? OPTIONS_TABLE_DEFINITIONS : OPTIONS_CHART_DEFINITIONS;

        for (const [key, def] of Object.entries(optionsDefs)) {
          const hasValue = config.options.hasOwnProperty(key);
          const value = config.options[key];
          // options.xxx í˜•íƒœë¡œ ì •í™•íˆ ë§¤ì¹­
          const hasWarning = warningFields.has(`options.${key}`);

          // ê°’ì´ ì—†ìœ¼ë©´ ìŠ¤í‚µ (options í•˜ìœ„ í•„ë“œëŠ” ì„ íƒì )
          if (!hasValue) continue;

          // ê¸°ë³¸ê°’ê³¼ ë™ì¼í•œ ê°’ì„ ëª…ì‹œì ìœ¼ë¡œ ì…ë ¥í–ˆëŠ”ì§€ ì²´í¬
          const isRedundant = hasValue && def.default !== undefined &&
            JSON.stringify(value) === JSON.stringify(def.default);

          // íƒ€ì… ê²€ì¦
          const typeCheck = hasValue && def.type ? checkType(value, def.type) : { valid: true, actualType: null };

          fields.push({
            name: def.label,
            desc: def.desc,
            hasValue,
            value: value,
            isDefault: false,
            isRedundant,
            valid: typeCheck.valid,
            error: null,
            typeError: !typeCheck.valid ? `íƒ€ì… ì˜¤ë¥˜: ${getTypeLabel(def.type)} í•„ìš”, ${getTypeLabel(typeCheck.actualType)} ì…ë ¥ë¨` : null,
            expectedType: def.type,
            actualType: typeCheck.actualType,
            required: false,
            hasWarning,
            isNested: true
          });
        }
      }

      return fields;
    }

    // í•„ë“œë³„ ê²°ê³¼ ë Œë”ë§
    function renderFieldResults(fields, isValid, recommendations = []) {
      const hasWarnings = recommendations.length > 0;

      let summaryText = isValid ? 'ëª¨ë“  í•„ë“œê°€ ìœ íš¨í•©ë‹ˆë‹¤' : 'ì¼ë¶€ í•„ë“œì— ì˜¤ë¥˜ê°€ ìˆìŠµë‹ˆë‹¤';
      let summaryClass = isValid ? 'success' : 'error';

      if (isValid && hasWarnings) {
        summaryText = `ìœ íš¨í•˜ì§€ë§Œ ${recommendations.length}ê°œì˜ ê¶Œì¥ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤`;
        summaryClass = 'warning';
      }

      const summaryHtml = `
        <div class="result-summary ${summaryClass}">
          ${summaryText}
        </div>
      `;

      // ê¶Œì¥ì‚¬í•­ ì„¹ì…˜
      const warningsHtml = hasWarnings ? `
        <div class="recommendations-section">
          <h4 style="color: #f0ad4e; margin-bottom: 8px; font-size: 13px;">ê¶Œì¥ì‚¬í•­</h4>
          ${recommendations.map(r => `
            <div class="field-item warning">
              <div class="field-warning">${escapeHtml(r.message)}</div>
            </div>
          `).join('')}
        </div>
      ` : '';

      const fieldsHtml = fields.map(f => {
        // ìš°ì„ ìˆœìœ„: error > warning > redundant > valid
        let statusClass = 'valid';
        if (!f.valid) statusClass = 'invalid';
        else if (f.hasWarning) statusClass = 'warning';
        else if (f.isRedundant) statusClass = 'redundant';

        // ì¤‘ì²© í•„ë“œ í´ë˜ìŠ¤
        const nestedClass = f.isNested ? 'nested' : '';

        // íƒ€ì… ë°°ì§€ ìƒì„±
        const typeBadge = f.expectedType ? `<span class="type-badge ${f.typeError ? 'type-error' : ''}">${getTypeLabel(f.expectedType)}</span>` : '';

        return `
          <div class="field-item ${statusClass} ${nestedClass}">
            <div class="field-header">
              <span class="field-name">${f.name}${f.required ? ' *' : ''}</span>
              <span class="field-status">${typeBadge}</span>
            </div>
            <div class="field-desc">${f.desc}</div>
            <div class="field-value">
              ${f.isDefault ? '<span class="default-badge">ê¸°ë³¸ê°’</span>' : ''}
              ${f.isRedundant ? '<span class="redundant-badge">ê¸°ë³¸ê°’ê³¼ ë™ì¼</span>' : ''}
              <code>${formatValue(f.value)}</code>
            </div>
            ${f.error ? `<div class="field-error">${escapeHtml(f.error)}</div>` : ''}
            ${f.typeError ? `<div class="field-error">${escapeHtml(f.typeError)}</div>` : ''}
            ${f.isRedundant ? `<div class="field-redundant">ì´ ê°’ì€ ê¸°ë³¸ê°’ê³¼ ë™ì¼í•©ë‹ˆë‹¤. ìƒëµí•´ë„ ë©ë‹ˆë‹¤.</div>` : ''}
          </div>
        `;
      }).join('');

      fieldResults.innerHTML = summaryHtml + warningsHtml + fieldsHtml;
    }

    // ê°’ í¬ë§·íŒ… (ë°°ì—´/ê°ì²´ëŠ” ì¶•ì•½)
    function formatValue(value) {
      if (value === undefined) return '<em style="color:#666">ë¯¸ì„¤ì •</em>';
      if (value === null) return 'null';

      if (Array.isArray(value)) {
        if (value.length === 0) return '[]';
        if (value.length > 5) {
          return `[${value.slice(0, 3).join(', ')}, ... +${value.length - 3}ê°œ]`;
        }
        return JSON.stringify(value);
      }

      if (typeof value === 'object') {
        const keys = Object.keys(value);
        if (keys.length === 0) return '{}';
        if (keys.length > 3) {
          return `{ ${keys.slice(0, 3).join(', ')}, ... }`;
        }
        return JSON.stringify(value);
      }

      if (typeof value === 'string' && value.includes('\n')) {
        return `"${value.substring(0, 30)}..."`;
      }

      return JSON.stringify(value);
    }

    // HTML ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§
    async function renderPreview(config, purpose) {
      previewContainer.innerHTML = '';

      try {
        // í…Œì´ë¸”ì€ ìë™ ë†’ì´, ì°¨íŠ¸ëŠ” 400 ì œí•œ
        const previewConfig = {
          ...config,
          animation: false
        };

        if (purpose === 'chart') {
          previewConfig.canvasSize = 400;
          await VizAPI.renderChart(previewContainer, previewConfig);
        } else {
          // í…Œì´ë¸”ì€ canvasSize ì œí•œ ì—†ì´ ìë™ ë†’ì´
          await VizAPI.renderTable(previewContainer, previewConfig);
        }

        previewSection.style.display = 'block';
      } catch (e) {
        console.error('ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ ì‹¤íŒ¨:', e);
        previewContainer.innerHTML = `<div style="color:#ff6b6b;">ë¯¸ë¦¬ë³´ê¸° ë Œë”ë§ ì‹¤íŒ¨: ${escapeHtml(e.message)}</div>`;
        previewSection.style.display = 'block';
      }
    }

    // ë¯¸ë¦¬ë³´ê¸° ìˆ¨ê¸°ê¸°
    function hidePreview() {
      previewSection.style.display = 'none';
      previewContainer.innerHTML = '';
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    validateBtn.addEventListener('click', validateJson);

    // Enter í‚¤ë¡œ ê²€ì¦ (Ctrl+Enter)
    jsonInput.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'Enter') {
        validateJson();
      }
    });

    // íŒ¨ë„ í† ê¸€ ì‹œìŠ¤í…œ
    const guideOverlay = document.getElementById('guideOverlay');
    const panels = {
      guide: document.getElementById('guidePanel'),
      chartOptions: document.getElementById('chartOptionsPanel'),
      tableOptions: document.getElementById('tableOptionsPanel'),
      fullJson: document.getElementById('fullJsonPanel')
    };
    const buttons = {
      guide: document.getElementById('guideToggleBtn'),
      chartOptions: document.getElementById('chartOptionsBtn'),
      tableOptions: document.getElementById('tableOptionsBtn'),
      fullJson: document.getElementById('fullJsonBtn')
    };

    let currentPanel = null;

    function openPanel(panelKey) {
      // ë‹¤ë¥¸ íŒ¨ë„ ë‹«ê¸°
      Object.values(panels).forEach(p => p.classList.remove('open'));
      // ì„ íƒí•œ íŒ¨ë„ ì—´ê¸°
      panels[panelKey].classList.add('open');
      guideOverlay.classList.add('open');
      currentPanel = panelKey;
    }

    function closeAllPanels() {
      Object.values(panels).forEach(p => p.classList.remove('open'));
      guideOverlay.classList.remove('open');
      currentPanel = null;
    }

    // ë²„íŠ¼ ì´ë²¤íŠ¸
    buttons.guide.addEventListener('click', () => openPanel('guide'));
    buttons.chartOptions.addEventListener('click', () => openPanel('chartOptions'));
    buttons.tableOptions.addEventListener('click', () => openPanel('tableOptions'));
    buttons.fullJson.addEventListener('click', () => openPanel('fullJson'));

    // ë‹«ê¸° ë²„íŠ¼ë“¤ (data-close-panel ì†ì„± ì‚¬ìš©)
    document.querySelectorAll('[data-close-panel]').forEach(btn => {
      btn.addEventListener('click', closeAllPanels);
    });
    // ê¸°ì¡´ guideCloseBtnë„ ì²˜ë¦¬
    document.getElementById('guideCloseBtn')?.addEventListener('click', closeAllPanels);

    // ì˜¤ë²„ë ˆì´ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
    guideOverlay.addEventListener('click', closeAllPanels);

    // ESC í‚¤ë¡œ ë‹«ê¸°
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && currentPanel) {
        closeAllPanels();
      }
    });
  </script>
</body>
</html>
